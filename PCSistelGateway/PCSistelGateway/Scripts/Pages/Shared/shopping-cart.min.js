function arrayObjectIndexOf(b,c,f){for(var g=0,h=b.length;g<h;g++)if(b[g][f]==c)return g;return-1}function listPedidos(){if(null!=localStorage.detallePedido&&(detallePedido=JSON.parse(localStorage.getItem("detallePedido")),0!=detallePedido.length)){$("#pedido-badge, #cantidad-pedido").css("display","").text(detallePedido.length);for(var f,b=$("#pedido-badge").data("url"),c=0;c<detallePedido.length;c++)f={EquipoId:detallePedido[c].EquipoId},$.ajax({type:"POST",url:b,data:f,success:function(g){var h=arrayObjectIndexOf(detallePedido,g.EquipoId,"EquipoId"),j="<li class=\"available\" data-equipo-id=\""+g.EquipoId+"\"><a><div class=\"notice-icon\"><i class=\"fa fa-mobile\"></i></div><div><span class=\"name\"><span class=\"name\"><strong>"+g.Nombre+"</strong><a href=\"#\" class=\"remove-pedido text-danger pull-right\"><i class=\"fa fa-trash fa-2x \"></i></a><span class=\"time small\" data-cantidad=\""+g.EquipoId+"\">Cantidad: "+detallePedido[h].Cantidad+"</span></span></div></a></li>";$("ul#shopping-cart").append(j)},error:function(){console.error("error")}});updateUrl(detallePedido)}}function deletePedidos(){localStorage.removeItem("detallePedido"),$("#pedido-badge").css("display","none"),$("ul#shopping-cart").html("");var b=$("#make-pedido"),c=b.data("href");b.attr("href",c),b.find("span").removeClass("text-success"),listPedidos()}function updateUrl(b){var c=$("#make-pedido"),f=c.data("href");if(0==b.length)c.attr("href",f),c.find("span").removeClass("text-success");else{for(var g="",h=0;h<b.length;h++)g+=b[h].EquipoId+","+b[h].Cantidad+(b.length==h+1?"":";");c.attr("href",f+"?l="+g),c.find("span").addClass("text-success")}}function deletePedido(b){try{if(null==localStorage.detallePedido)return!1;for(var c=JSON.parse(localStorage.getItem("detallePedido")),f=[],g=0;g<c.length;g++)c[g].EquipoId!=b&&f.push(c[g]);return localStorage.setItem("detallePedido",JSON.stringify(f)),!0}catch(h){return!1}}$(function(){listPedidos(),$(document).on("click",".new-pedido",function(){$("#modal-equipoId, #modal-cantidad").val("");var b=$(this).data("equipo-id");d=$(this).data("nombre"),e=$(this).data("max"),$("#modal-pedido-titulo").text(d),$("#modal-equipoId").val(b),$("#modal-cantidad").attr("max",e)}),$("#add-pedido").on("click",function(){var b=$(this).data("url"),c={EquipoId:parseInt($("#modal-equipoId").val()),Cantidad:parseInt($("#modal-cantidad").val())},f={EquipoId:c.EquipoId},g=[],h=parseInt($("#modal-cantidad").attr("max"));c.Cantidad>h&&(c.Cantidad=h),null!=localStorage.detallePedido&&(g=JSON.parse(localStorage.getItem("detallePedido")));var j=arrayObjectIndexOf(g,c.EquipoId,"EquipoId"),k=!1;-1==j?g.push(c):(k=!0,g[j].Cantidad=c.Cantidad),localStorage.setItem("detallePedido",JSON.stringify(g)),$("#pedido-badge, #cantidad-pedido").css("display","").text(g.length),$.ajax({type:"POST",url:b,data:f,success:function(m){if(k)$("[data-cantidad="+m.EquipoId+"]").text("Cantidad: "+g[j].Cantidad);else{var n="<li class=\"available\" data-equipo-id=\""+c.EquipoId+"\"><a><div class=\"notice-icon\"><i class=\"fa fa-mobile\"></i></div><div><span class=\"name\"><strong>"+m.Nombre+"</strong><a href=\"#\" class=\"remove-pedido text-danger pull-right\"><i class=\"fa fa-trash fa-2x \"></i></a><span class=\"time small\" data-cantidad=\""+m.EquipoId+"\">Cantidad: "+c.Cantidad+"</span></span></div></a></li>";$("ul#shopping-cart").append(n)}},error:function(){console.error("error")}}),$("#modal-pedido").modal("hide"),updateUrl(g)}),$(document).on("click",".remove-pedido",function(){var b=$(this).closest("li"),c=b.data("equipo-id");if(console.log(c),deletePedido(c)&&b.remove(),null!=localStorage.detallePedido){var f=JSON.parse(localStorage.getItem("detallePedido"));0==f.length?($("#pedido-badge").css("display","none"),$("#cantidad-pedido").css("display","").text(f.length)):$("#pedido-badge, #cantidad-pedido").css("display","").text(f.length),updateUrl(f)}})});